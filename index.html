<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <script src="https://static.line-scdn.net/liff/edge/2/sdk.js"></script>
</head>
<body>
    クエリパラメーター：<span id="qp"></span>
    <div id="test">null</div>
    <script>
      // LIFF初期化
      liff
        .init({ liffId: "2007545023-YwdxGxoV" })
        .then(() => {
            if (!liff.isLoggedIn()) {
            liff.login(); // 必要ならログイン
            }
        })
        .then(async () => {
            const isFriend = await liff.getFriendship();

            if (!isFriend.friendFlag) {
                // 友だちでない場合は友だち追加ページに遷移
                // liff.openWindow({
                //     url: "https://line.me/R/ti/p/@あなたの公式アカウントID",
                //     external: true
                // });
                document.getElementById('test').textContent = '0';
            } else {
                // 友だちの場合は通常のアプリ処理
                console.log("友だち登録済み");
                document.getElementById('test').textContent = '1';
            }

            const params = new URLSearchParams(window.location.search);

            let queryString = "";
            if (params.has("liff.state")) {
                // liff.state を取得して decode
                queryString = params.get("liff.state");
            } else {
                queryString = window.location.search;
            }

            // 「?」を取り除き、URLSearchParamsでパース
            const queryParams = new URLSearchParams(queryString.replace(/^\?/, ""));
            const obj = {};
            for (const [key, value] of queryParams.entries()) {
                obj[key] = value;
            }
            document.getElementById("qp").textContent = JSON.stringify(obj, null, 2);
        })
        .catch((err) => {
          console.error("LIFF 初期化エラー:", err);
        });
    </script>
</body>
</html>